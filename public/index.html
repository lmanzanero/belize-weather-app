<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link rel="icon" type="image/x-icon" href="Belize-icon.png">
  <link rel="stylesheet" href="player.css" />
  <link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.2/css/all.min.css"
/>
  <title>Belize Weather Forecast - Daily, Weekly, Montly</title>  
  <style media="screen">
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: #dbe1e8; 
      margin: 0;
      padding: 0; 
      font-family: "Courier New", Courier, monospace;
    }

    .weather-box {
      display: block;
      margin: auto;
      width: 90vw;
      height: auto;
      padding: 1em;
      margin: 1em auto;
      background-color: #f8f8f8;
      border-radius: 5px;
      text-align: center;
      justify-content: center;
      box-shadow: rgba(0, 0, 0, 0.06) 0px 2px 4px 0px inset;
      -webkit-background-size: cover;
      -moz-background-size: cover;
      -o-background-size: cover;
      background-size: cover;
    }

    .weather-box h1 {
      color: #6c7983;
      display: block;
      justify-content: center;
      text-align: center;
      margin: 0.5em auto;
      padding: 1em; 
      width: 70%;
      border-radius: 0.4em;
      background-color: #dbe1e8; 
    }

    .weather-container {
      display: grid;
      grid-template-columns: 1fr 2fr;
      padding: 2.5em 0px;
    }

    .map {
      height: 100%;
      max-height: 500px;
      width: 100%;
    }

    .map img {
      height: 100%;
    }

    .weather-details {
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      gap: 1em;
    }

    .weather-details .weather-detail {
      display: flex;
      flex-direction: row;
      margin: 0 auto;
      flex-wrap: wrap;
      justify-content: space-around;
      gap: 1em;
      width: 100%;
    }

    .weather-details .weather-detail button {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap-reverse;
      margin: auto;
      justify-content: center;
      align-items: center;
      height: 80px;
      font-weight: 600;
      min-width: 100px;
      border: none;
      border-radius: 0.3em;
      background: #dbe1e8;
      font-size: 10px;
      color: #6c7983;
      box-shadow: rgba(0, 0, 0, 0.06) 0px 2px 4px 0px inset;
    }

    .weather-details .weather-detail button:hover {
      font-weight: 700;
      box-shadow: 0px 3px 15px rgba(0, 0, 0, 0.2);
    }


    label {
      font-size: larger;
    }
    
    select {
      -moz-appearance: none;
      -webkit-appearance: none;
      background: #dbe1e8;
      border: none;
      border-radius: 0;
      cursor: pointer;
      padding: 12px;
      margin: auto;
      border-radius: 0.3em;
      width: 100%; 
      font-size: 18px;
      box-shadow: rgba(0, 0, 0, 0.06) 0px 2px 4px 0px inset;
    }

    select:focus {
      background-color: #dbe1e8;
    }
    h2, h4 {
       color: #6c7983;
    }
    .sevenday-forcast {
      display: grid;
      height: 200px;
    }

    .forecast-table {
      margin: 1em 0;  
      background-color: #dbe1e8;
      box-shadow: rgba(0, 0, 0, 0.06) 0px 2px 4px 0px inset;
      border-radius: 0.2em;
    }

    .forecast-table tr {
      border-top: 1px solid #ddd;
      border-bottom: 1px solid #ddd; 
    }

    .forecast-table th { 
      padding: 0.5em;
    }

    .forecast-table td {
      display: block;
      font-size: x-small;
      font-weight: bolder;
    }

    .forecast-table td:first-child {
      padding-top: 0.5em;
    }

    .forecast-table td:last-child {
      padding-bottom: 0.5em;
    }

    .forecast-table td:before {
      content: attr(data-th) ": ";
      font-weight: bold;
      width: 6.5em; 
      display: inline-block;

    }

    @media (min-width: 480px) {
      .forecast-table td:before {
        display: none;
      }
    }

 

    @media (min-width: 480px) {

      .forecast-table th,
      .forecast-table td {
        display: table-cell;
        padding: 0.5em 0.5em;
      }

      .forecast-table th:first-child,
      .forecast-table td:first-child {
        padding-left: 1em;
        font-size:medium;
      }

      .forecast-table th:last-child,
      .forecast-table td:last-child {
        padding-right: 1em;
      }
    }

    .graphs {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      gap: 1em;
      justify-content: space-evenly; 
      margin: 2.5em auto;
    }

    .graphs .graph-container {
      height: 300px;
      width: 380px;
      overflow: hidden; 
      box-shadow: rgba(0, 0, 0, 0.06) 0px 2px 4px 0px inset;
      border-radius: 0.4em;
    }

    .graphs .graph-container .graph-title {
      color: #6c7983;
      background-color: #dbe1e8; 
      line-height: 1.5em;
    }

    .graphs .graph-container img {
      width: 100%;
      height: 100%;
      object-fit:cover; 
    }

    footer { 
      color: #6c7983;
      background-color: #dbe1e8; 
      margin: 1em auto;
      text-align: center;
      border-radius: 0.4em;
    }

    footer p {
      font-size: 1.5em;
      line-height: 0.5em;
      margin: 1em auto;
      padding: 0.5em;
    }
    @media only screen and (max-width: 860px) {
      .weather-box {
        padding: 0;
        margin: auto;
        width: 100%;
      }
      .weather-container {
        grid-template-columns: 1fr;
        height: 100%;
        width: 100%;
        margin: auto;
        padding: 0; 
        gap: 2em;
      }

      table {
        font-size: xx-small;
      }
    }

  </style>
</head>

<body> 
    <div class="weather-box">
      <h1><strong>Belize Weather</strong></h1>
      <div class="weather-container">
        <div class="map">
          <img src="https://simplemaps.com/static/svg/bz/bz.svg" alt="Belize SVG Map" />
        </div>
        <div class="weather-details">
          <div class="music-container" id="music-container">
            <div class="music-info">
              <h4 id="title"></h4>
              <div class="progress-container" id="progress-container">
                <div class="progress" id="progress"></div>
              </div>
            </div>
      
            <audio src="" id="audio"></audio>
      
            <div class="img-container">
              <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e7/Flag_of_Belize.svg/1280px-Flag_of_Belize.svg.png" alt="music-cover" id="cover" />
            </div>
            <div class="navigation">
              <button id="prev" class="action-btn">
                <i class="fas fa-backward"></i>
              </button>
              <button id="play" class="action-btn action-btn-big">
                <i class="fas fa-play"></i>
              </button>
              <button id="next" class="action-btn">
                <i class="fas fa-forward"></i>
              </button>
            </div>
          </div>
          <label for="locations">Choose a location</label>
          <select name="locations" id="locations">
            <option value="Corozal">Corozal</option>
            <option value="Orange Walk">Orange Walk</option>
            <option value="Belize City">Belize City</option>
            <option value="Cayo">Cayo</option>
            <option value="Stann Creek">Stann Creek</option>
            <option value="Toldeo">Toldeo</option>
          </select>
          <div class="weather-detail">
            <button type="button" class="city"></button>
            <button type="button" class="icon"></button>
            <button type="button" class="temperature"></button>
            <button type="button" class="wind"></button>
          </div>
          <!-- <div class="progress"></div> -->
          <div class="sevenday-forcast">
            <h4>7 Day Forcast</h4>
            <table class="forecast-table">
              <tr>
                <th>Country</th>
                <th class="day">Mon</th>
                <th class="day">Tue</th>
                <th class="day">Wed</th>
                <th class="day">Thu</th>
                <th class="day">Fri</th>
                <th class="day">Sat</th>
                <th class="day">Sun</th>
              </tr>
              <tr class="tableInfo">
                <td class="dayHeader">Day</td>
                <td class="dayTemps">...</td>
                <td class="dayTemps">...</td>
                <td class="dayTemps">...</td>
                <td class="dayTemps">...</td>
                <td class="dayTemps">...</td>
                <td class="dayTemps">...</td>
                <td class="dayTemps">...</td>
              </tr>
              <tr class="tableInfo">
                <td class="dayHeader">Night</td>
                <td class="nightTemps">...</td>
                <td class="nightTemps">...</td>
                <td class="nightTemps">...</td>
                <td class="nightTemps">...</td>
                <td class="nightTemps">...</td>
                <td class="nightTemps">...</td>
                <td class="nightTemps">...</td>
              </tr>
              <tr class="tableInfo">
                <td class="dayHeader">Apparent</td>
                <td class="feelsLike">...</td>
                <td class="feelsLike">...</td>
                <td class="feelsLike">...</td>
                <td class="feelsLike">...</td>
                <td class="feelsLike">...</td>
                <td class="feelsLike">...</td>
                <td class="feelsLike">...</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="weather-box">
      <h2>Weather Graphs</h2>
      <div class="graphs">
        <div class="graph-container">
          <div class="graph-title">
            Radar
          </div>
          <img src="http://nms.gov.bz/images/radar/250/latest_250kmloop.gif" alt="Belize Live Weather Radar"/>
        </div>
        <div class="graph-container">
          <div class="graph-title">
            Satallite
          </div>
          <img src="https://nms.gov.bz/images/radar/250/latest_PAC_250kmpic.gif" alt="Belize Live Weather Satallite"/>
        </div>
        <div class="graph-container">
          <div class="graph-title">
            Weather Stations
          </div>
          <img src="https://www.researchgate.net/profile/Jonathan-Lashley/publication/295078178/figure/fig2/AS:330834843324422@1455888581393/Location-of-Weather-Stations-in-Belize.png" alt="Belize Live Weather Stations"/>
        </div>
      </div>
    </div>
    <footer>
      <p>
        View Source Code
        <a href="https://github.com/lmanzanero/weather-app" target="_blank">
          Here</a>
      </p>
    </footer> 
  </div>
  <script type="text/javascript">
    let lon;
    let lat;
    let city = document.querySelector(".city");
    let icon = document.querySelector(".icon");
    let temp = document.querySelector(".temperature");
    let wind = document.querySelector(".wind");  
    let th = document.querySelectorAll("table tr .day");
    let dayTemps = document.querySelectorAll("table .tableInfo .dayTemps");
    let nightTemps = document.querySelectorAll("table .tableInfo .nightTemps");
    let feelsLike = document.querySelectorAll("table .tableInfo .feelsLike")
    // const colors = ["blue", "green", "Yellow", "red"];
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function (position) {
        lat = position.coords.latitude;
        long = position.coords.longitude;
        getWeather(`api/location?long=${long}&lat=${lat}`);
        getForcast(`api/forecast`);
        let photoLoc =
          `https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=${position.coords.latitude},${position.coords.longitude}&radius=100&type=&keyword=&key=GOOGLE_API_KEY`;
        // getGeoPhoto(photoLoc);
      });
    } else {
      console.log("Geolocation is not supported by this browser.");
    }
    //Gets Geo photo
    // function getGeoPhoto(url) {
    //   fetch(url, {
    //     method: "GET",
    //   })
    //     .then((response) => response.json())
    //     .then(function (data) {
    //       const photoReference = data.results[0].photos[0].photo_reference;
    //       let locationPicture = `https://maps.googleapis.com/maps/api/place/photo?maxwidth=700&photoreference=${photoReference}&key=GOOGLE_API_KEY`;
    //       document.querySelector(
    //         ".weather-box"
    //       ).style.backgroundImage = `url(${locationPicture})`;
    //     })
    //     .catch(function (error) {
    //       console.log("Request failed", error);
    //     });
    // }

    async function getForcast(forecast) {
      try {
        const response = await fetch(forecast);
        const data = await response.json(); 
        const days = data.daily.map(day => { 
          let dayLong = new Date(day.dt * 1000).toLocaleString('en-us', {weekday:'long'}); 
          let dayShorted = dayLong.substr(0, 3); 
          return { 
            dayShorted: dayShorted, 
            maxTemp: day.temp.max, 
            minTemp: day.temp.min,
            nightTemp: day.temp.night,
            feelsLike: day.feels_like.day
          };
        }) 
        th.forEach((header, index) => {
            header.textContent = days[index].dayShorted;
          });
        dayTemps.forEach((row, index) => { 
           row.textContent = `${(days[index].minTemp - 273.15).toFixed(1)} - ${(days[index].maxTemp - 273.15).toFixed(1)}`;
        });

        nightTemps.forEach((row, index) => {
          row.textContent = `${(days[index].nightTemp - 273.15).toFixed(1)}`;
        });

        feelsLike.forEach((row, index) => {
          row.textContent = `${(days[index].feelsLike - 273.15).toFixed(1)}`;
        })
      } catch (error) {
        console.log(error);
      }
    }

    async function getWeather(api) { 
      await fetch(api)
        .then((response) => response.json())
        .then((data) => {  
          city.textContent = `${data.name}, ${data.sys.country}`;
          icon.innerHTML =
            `${data.weather[0].description} <span><img src="https://openweathermap.org/img/w/${data.weather[0].icon}.png" alt="" /></span>`;
          let far = ((data.main.temp - 273.15) * 9) / 5 + 32;
          let cel = data.main.temp - 273.15; 
          temp.textContent = `${Math.floor(far)} ℉`;
          //Simple Toggle for temperatures
          let toggle = false;
          function Toggle() {
            if (!toggle) {
              temp.textContent = `${Math.floor(far)} ℉`;
              toggle = true;
            } else {
              temp.textContent = `${Math.floor(cel)} ℃`;
              toggle = false;
            }
          }

          //Fixes the bug so I don't have to double click to switch on the first try, so hover only works once
          temp.addEventListener("mouseover", Toggle, {
            once: true,
          });
          temp.addEventListener("click", Toggle);

          wind.innerHTML = `${data.wind.speed} Knots`;
        })
        .catch(function (error) {
          console.log("Request failed", error.response);
        });
    }
  </script>
  <script src="player.js"></script>
  <!-- <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=GOOGLE_API_KEY&libraries=places">
  </script> -->
</body>

</html>